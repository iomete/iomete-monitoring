apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-grafana-application-folder
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "iomete-monitoring-chart.labels" . | nindent 4}}
data:
  {{- $files := .Files }}
  {{- range $path, $_ := .Files.Glob "grafana-dashboards/application/*.json" }}
  {{ base $path }}: |-
    {{- $content := $files.Get $path }}
    {{- $content = replace "${DS_PROMETHEUS}" "Prometheus" $content }}
    {{- $content = replace "${datasource}" "Prometheus" $content }}
    {{- $content | nindent 4 }}
  {{- end }}

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-grafana-spark-folder
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "iomete-monitoring-chart.labels" . | nindent 4}}
data:
  {{- $files := .Files }}
  {{- range $path, $_ := .Files.Glob "grafana-dashboards/spark/*.json" }}
  {{ base $path }}: |-
    {{- $content := $files.Get $path }}
    {{- $content = replace "${DS_PROMETHEUS}" "Prometheus" $content }}
    {{- $content = replace "${datasource}" "Prometheus" $content }}
    {{- $content | nindent 4 }}
  {{- end }}

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-grafana-kubernetes-folder
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "iomete-monitoring-chart.labels" . | nindent 4}}
data:
  {{- $files := .Files }}
  {{- range $path, $_ := .Files.Glob "grafana-dashboards/kubernetes/*.json" }}
  {{ base $path }}: |-
    {{- $content := $files.Get $path }}
    {{- $content = replace "${DS_PROMETHEUS}" "Prometheus" $content }}
    {{- $content = replace "${datasource}" "Prometheus" $content }}
    {{- $content | nindent 4 }}
  {{- end }}


---

 {{ if .Values.grafana.alerting.enabled }}

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-grafana-alert-folder
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "iomete-monitoring-chart.labels" . | nindent 4}}
data:
  {{- $files := .Files }}
  {{- range $path, $_ := .Files.Glob "grafana-dashboards/alerts/*.json" }}
  {{ base $path }}: |-
    {{- $content := $files.Get $path }}
    {{- $content = replace "${DS_PROMETHEUS}" "Prometheus" $content }}
    {{- $content = replace "${datasource}" "Prometheus" $content }}
    {{- $content | nindent 4 }}
  {{- end }}

{{- end }}

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-grafana-internal-folder
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "iomete-monitoring-chart.labels" . | nindent 4}}
data:
  {{- $files := .Files }}
  {{- range $path, $_ := .Files.Glob "grafana-dashboards/internal/*.json" }}
  {{ base $path }}: |-
    {{- $content := $files.Get $path }}
    {{- $content = replace "${DS_PROMETHEUS}" "Prometheus" $content }}
    {{- $content = replace "${datasource}" "Prometheus" $content }}
    {{- $content | nindent 4 }}
  {{- end }}
